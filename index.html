<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Absensi Guru</title>

  <!-- Google Font: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            primary: '#4f46e5', // Indigo-600
          }
        }
      }
    }
  </script>

  <style>
    body { background: #f8fafc; }
    .card { @apply bg-white rounded-xl shadow-lg border border-gray-100; }
    .btn-primary { @apply bg-primary hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-lg transition shadow-md flex items-center justify-center gap-3; }
    .input-group { @apply relative mb-5; }
    .input-group input { @apply w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent; }
    .input-icon { @apply absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500; }
    .toggle-pass { @apply absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer text-gray-500 hover:text-gray-700; }
    #toast-container { @apply fixed bottom-6 right-6 z-50 space-y-3; }
    .toast { @apply max-w-sm w-full p-4 rounded-lg shadow-xl text-white flex items-center gap-4 opacity-0 translate-y-4 transition-all duration-300; }
    .toast.show { @apply opacity-100 translate-y-0; }
    .toast.success { @apply bg-green-600; }
    .toast.error { @apply bg-red-600; }
    .sidebar-active { @apply bg-indigo-50 text-primary border-r-4 border-primary; }
  </style>
</head>
<body class="text-gray-800">

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Login Page -->
  <div id="loginPage" class="min-h-screen flex items-center justify-center px-4 bg-gradient-to-br from-gray-50 to-indigo-50">
    <div class="card w-full max-w-md p-10">
      <div class="text-center mb-10">
        <div class="mx-auto w-20 h-20 bg-primary rounded-2xl flex items-center justify-center mb-6 shadow-md">
          <svg class="w-12 h-12 text-white"><use href="#hero-building-office"/></svg>
        </div>
        <h2 class="text-3xl font-bold text-gray-800">Absensi Guru</h2>
        <p class="text-gray-600 mt-3">Masuk ke akun Anda</p>
      </div>

      <div class="space-y-6">
        <div class="input-group">
          <div class="input-icon">
            <svg class="w-5 h-5"><use href="#hero-user"/></svg>
          </div>
          <input id="username" type="text" placeholder="Username" autocomplete="username">
        </div>

        <div class="input-group">
          <div class="input-icon">
            <svg class="w-5 h-5"><use href="#hero-lock-closed"/></svg>
          </div>
          <input id="password" type="password" placeholder="Password" autocomplete="current-password">
          <div class="toggle-pass" onclick="togglePassword()">
            <svg class="w-5 h-5" id="eye-icon"><use href="#hero-eye"/></svg>
          </div>
        </div>

        <button onclick="login()" class="w-full btn-primary text-lg">
          <svg class="w-5 h-5"><use href="#hero-arrow-right"/></svg>
          Masuk
        </button>
      </div>

      <p id="loginMsg" class="text-red-600 text-center mt-6 font-medium"></p>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="hidden min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white shadow-md px-6 py-4 flex justify-between items-center sticky top-0 z-40 border-b">
      <h1 class="text-2xl font-bold text-primary">Absensi Guru</h1>
      <div class="flex items-center gap-6">
        <span id="userName" class="font-medium text-gray-700"></span>
        <button onclick="logout()" class="text-red-600 hover:text-red-700 font-medium flex items-center gap-2">
          <svg class="w-5 h-5"><use href="#hero-arrow-left-on-rectangle"/></svg>
          Logout
        </button>
      </div>
    </nav>

    <div class="flex flex-col lg:flex-row min-h-screen">
      <!-- Sidebar -->
      <aside class="lg:w-64 bg-white border-r border-gray-200 p-6">
        <ul class="space-y-2">
          <li id="menuDashboard" class="hidden">
            <button onclick="showPage('dashboard')" class="w-full text-left py-3 px-4 rounded-lg hover:bg-gray-100 flex items-center gap-4 font-medium transition">
              <svg class="w-5 h-5 text-gray-600"><use href="#hero-home"/></svg>
              Dashboard
            </button>
          </li>
          <li>
            <button onclick="showPage('absensi')" class="w-full text-left py-3 px-4 rounded-lg flex items-center gap-4 font-medium transition sidebar-active">
              <svg class="w-5 h-5"><use href="#hero-check-circle"/></svg>
              Absensi
            </button>
          </li>
          <li>
            <button onclick="showPage('rekap')" class="w-full text-left py-3 px-4 rounded-lg hover:bg-gray-100 flex items-center gap-4 font-medium transition">
              <svg class="w-5 h-5 text-gray-600"><use href="#hero-chart-bar"/></svg>
              Rekap & Grafik
            </button>
          </li>
          <li id="menuManager" class="hidden">
            <button onclick="showPage('manager')" class="w-full text-left py-3 px-4 rounded-lg hover:bg-gray-100 flex items-center gap-4 font-medium transition">
              <svg class="w-5 h-5 text-gray-600"><use href="#hero-users"/></svg>
              Data Manager
            </button>
          </li>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-6 lg:p-10 bg-gray-50">
        <!-- Dashboard Admin -->
        <div id="dashboard" class="hidden">
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-3 text-gray-800">
            <svg class="w-8 h-8 text-primary"><use href="#hero-home"/></svg>
            Dashboard Admin
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="card p-8">
              <p class="text-gray-600 text-lg mb-3">Hadir Hari Ini</p>
              <p id="hariIni" class="text-5xl font-bold text-primary">0</p>
            </div>
            <div class="card p-8">
              <p class="text-gray-600 text-lg mb-3">Total Bulan Ini</p>
              <p id="bulanIni" class="text-5xl font-bold text-primary">0</p>
            </div>
          </div>
        </div>

        <!-- Absensi -->
        <div id="absensi">
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-3 text-gray-800">
            <svg class="w-8 h-8 text-green-600"><use href="#hero-check-circle"/></svg>
            Absensi Hari Ini
          </h2>
          <div class="card p-10">
            <p class="text-lg mb-8 text-gray-700">Tanggal: <span id="todayDate" class="font-bold text-primary"></span></p>

            <button id="btnAbsen" onclick="doAbsen()" class="btn-primary text-lg px-12 py-5 mx-auto">
              <svg class="w-7 h-7"><use href="#hero-hand-thumb-up"/></svg>
              Absen Sekarang
            </button>

            <p id="absenMsg" class="text-center mt-10 text-lg font-medium"></p>

            <div class="mt-12 pt-8 border-t border-gray-200">
              <h3 class="text-xl font-bold mb-4 text-center text-gray-800">Rekap Bulan Ini</h3>
              <p class="text-center text-lg">Total Kehadiran: <span id="totalBulan" class="font-bold text-primary">0</span> hari</p>
              <p class="text-center text-gray-600 text-sm mt-2">(Periode: 26 bulan lalu â€” 25 hari ini)</p>
            </div>
          </div>
        </div>

        <!-- Rekap & Grafik -->
        <div id="rekap" class="hidden">
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-3 text-gray-800">
            <svg class="w-8 h-8 text-primary"><use href="#hero-chart-bar"/></svg>
            Rekap & Grafik Kehadiran
          </h2>

          <div class="card p-8 mb-8">
            <canvas id="attendanceChart"></canvas>
          </div>

          <div class="card overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-gray-50 border-b">
                  <tr>
                    <th class="p-5 text-left font-medium text-gray-700">Tanggal</th>
                    <th class="p-5 text-left font-medium text-gray-700">Nama Guru</th>
                    <th class="p-5 text-left font-medium text-gray-700">Waktu Absen</th>
                  </tr>
                </thead>
                <tbody id="rekapTable" class="divide-y divide-gray-100"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Data Manager -->
        <div id="manager" class="hidden">
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-3 text-gray-800">
            <svg class="w-8 h-8 text-primary"><use href="#hero-users"/></svg>
            Data Manager
          </h2>
          <div class="card overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-gray-50 border-b">
                  <tr>
                    <th class="p-5 text-left font-medium text-gray-700">Nama</th>
                    <th class="p-5 text-left font-medium text-gray-700">Username</th>
                    <th class="p-5 text-left font-medium text-gray-700">Password Baru</th>
                    <th class="p-5 text-left font-medium text-gray-700">Role</th>
                    <th class="p-5 text-left font-medium text-gray-700">Aksi</th>
                  </tr>
                </thead>
                <tbody id="userTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Heroicons SVG Symbols -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none;">
    <symbol id="hero-building-office" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
    </symbol>
    <symbol id="hero-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
    </symbol>
    <symbol id="hero-lock-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
    </symbol>
    <symbol id="hero-eye" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
      <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
    </symbol>
    <symbol id="hero-eye-slash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 011.952-3.055M6.118 6.118L3 9m3.118-3.118L9 3m5.882 15.882L21 21m-3.118-3.118L15 21m-5.882-2.118A3 3 0 119 12a3 3 0 013.882 5.882"/>
    </symbol>
    <symbol id="hero-arrow-right" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 5l7 7-7 7"/>
    </symbol>
    <symbol id="hero-arrow-left-on-rectangle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 19l-7-7 7-7"/>
      <path d="M4 12h16"/>
    </symbol>
    <symbol id="hero-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
    </symbol>
    <symbol id="hero-check-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </symbol>
    <symbol id="hero-chart-bar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
    </symbol>
    <symbol id="hero-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
    </symbol>
    <symbol id="hero-hand-thumb-up" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
    </symbol>
    <symbol id="hero-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M5 13l4 4L19 7"/>
    </symbol>
  </svg>

<script>
// GANTI DENGAN URL WEB APP ANDA!
const API_URL = 'https://script.google.com/macros/s/AKfycbx01WEQHO7bIt0bU0Km3IyJ50ZDw5VaAJoJEic7Yg95WS9vpkPxUIYPbVEdD0nSFqxqEQ/exec';

let currentUser = JSON.parse(localStorage.getItem('absensiUser')) || null;
let chartInstance = null;

function formatDate(date) {
  return date.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}

function getMonthRange() {
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const start = new Date(year, month - 1, 26);
  const end = new Date(year, month, 25);
  return { start: start.toISOString().split('T')[0], end: end.toISOString().split('T')[0] };
}

async function apiCall(action, params = {}, method = 'GET') {
  let url = `${API_URL}?action=${action}`;
  if (method === 'GET' && Object.keys(params).length) {
    Object.keys(params).forEach(key => url += `&${key}=${encodeURIComponent(params[key])}`);
  }
  const options = { method };
  if (method === 'POST') {
    options.headers = { 'Content-Type': 'application/json' };
    options.body = JSON.stringify({ action, ...params });
  }
  const res = await fetch(url, options);
  return await res.json();
}

// Toast Notification
function showToast(message, type = 'success') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type} show`;
  toast.innerHTML = `
    <svg class="w-6 h-6 flex-shrink-0"><use href="#hero-check-circle"/></svg>
    <span class="font-medium">${message}</span>
  `;
  container.appendChild(toast);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, 4000);
}

// Toggle Password
function togglePassword() {
  const pass = document.getElementById('password');
  const icon = document.getElementById('eye-icon');
  if (pass.type === 'password') {
    pass.type = 'text';
    icon.setAttribute('href', '#hero-eye-slash');
  } else {
    pass.type = 'password';
    icon.setAttribute('href', '#hero-eye');
  }
}

async function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  if (!username || !password) {
    document.getElementById('loginMsg').textContent = 'Username dan password wajib diisi!';
    return;
  }
  const result = await apiCall('login', { username, password });
  if (result.success) {
    currentUser = result;
    localStorage.setItem('absensiUser', JSON.stringify(currentUser));
    initApp();
  } else {
    document.getElementById('loginMsg').textContent = 'Username atau password salah!';
  }
}

function logout() {
  localStorage.removeItem('absensiUser');
  currentUser = null;
  location.reload();
}

function initApp() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('mainApp').classList.remove('hidden');
  document.getElementById('userName').textContent = currentUser.nama;

  if (currentUser.role === 'admin') {
    document.getElementById('menuDashboard').classList.remove('hidden');
    document.getElementById('menuManager').classList.remove('hidden');
    showPage('dashboard');
    loadDashboard();
  } else {
    showPage('absensi');
  }

  document.getElementById('todayDate').textContent = formatDate(new Date());
  loadAbsensi();
  loadRekap();
  loadChart();
  if (currentUser.role === 'admin') loadUsers();
}

function showPage(page) {
  document.querySelectorAll('main > div').forEach(el => el.classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');

  // Update sidebar active
  document.querySelectorAll('aside button').forEach(btn => {
    btn.classList.remove('sidebar-active');
    btn.querySelector('svg').classList.add('text-gray-600');
    btn.querySelector('svg').classList.remove('text-primary');
  });
  const activeBtn = document.querySelector(`[onclick="showPage('${page}')"]`) || 
                    document.querySelector(`#menu${page.charAt(0).toUpperCase() + page.slice(1)} button`);
  if (activeBtn) {
    activeBtn.classList.add('sidebar-active');
    activeBtn.querySelector('svg').classList.remove('text-gray-600');
    activeBtn.querySelector('svg').classList.add('text-primary');
  }
}

async function doAbsen() {
  const btn = document.getElementById('btnAbsen');
  const originalHTML = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = '<span class="animate-pulse">Memproses...</span>';

  const today = new Date().toISOString().split('T')[0];
  const result = await apiCall('absen', { nama: currentUser.nama, tanggal: today }, 'POST');

  if (result.success) {
    showToast(result.message || 'Absen berhasil!', 'success');
    document.getElementById('absenMsg').textContent = '';
  } else {
    showToast(result.message || 'Anda sudah absen hari ini!', 'error');
  }

  btn.disabled = false;
  btn.innerHTML = originalHTML;

  loadAbsensi();
  loadRekap();
  loadChart();
  if (currentUser.role === 'admin') loadDashboard();
}

async function loadAbsensi() {
  const data = await apiCall('getAbsensiUser', { nama: currentUser.nama });
  const range = getMonthRange();
  let count = 0;
  data.forEach(row => {
    if (row.tanggal >= range.start && row.tanggal <= range.end) count++;
  });
  document.getElementById('totalBulan').textContent = count;
}

async function loadRekap() {
  const data = await apiCall('getAllAbsensi');
  const tbody = document.getElementById('rekapTable');
  tbody.innerHTML = '';
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.className = 'hover:bg-gray-50 transition';
    tr.innerHTML = `
      <td class="p-5">${row.tanggal}</td>
      <td class="p-5 font-medium">${row.nama}</td>
      <td class="p-5 text-gray-600">${row.waktu}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function loadDashboard() {
  const data = await apiCall('getAllAbsensi');
  const today = new Date().toISOString().split('T')[0];
  const range = getMonthRange();

  const uniqueToday = new Set();
  const uniqueMonth = new Set();

  data.forEach(row => {
    if (row.tanggal === today) uniqueToday.add(row.nama);
    if (row.tanggal >= range.start && row.tanggal <= range.end) uniqueMonth.add(row.nama);
  });

  document.getElementById('hariIni').textContent = uniqueToday.size;
  document.getElementById('bulanIni').textContent = uniqueMonth.size;
}

async function loadChart() {
  const data = await apiCall('getAllAbsensi');
  const range = getMonthRange();

  const dailyCount = {};
  data.forEach(row => {
    if (row.tanggal >= range.start && row.tanggal <= range.end) {
      dailyCount[row.tanggal] = (dailyCount[row.tanggal] || 0) + 1;
    }
  });

  const labels = [];
  const counts = [];
  let current = new Date(range.start);
  const endDate = new Date(range.end);
  while (current <= endDate) {
    const dateStr = current.toISOString().split('T')[0];
    labels.push(current.getDate());
    counts.push(dailyCount[dateStr] || 0);
    current.setDate(current.getDate() + 1);
  }

  const ctx = document.getElementById('attendanceChart').getContext('2d');
  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Jumlah Hadir',
        data: counts,
        backgroundColor: '#4f46e5',
        borderRadius: 6,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });
}

async function loadUsers() {
  const data = await apiCall('getAllUsers');
  const tbody = document.getElementById('userTable');
  tbody.innerHTML = '';
  data.forEach(user => {
    const tr = document.createElement('tr');
    tr.className = 'hover:bg-gray-50';
    tr.innerHTML = `
      <td class="p-5"><input value="${user.nama}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></td>
      <td class="p-5"><input value="${user.username}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></td>
      <td class="p-5"><input type="password" placeholder="Kosongkan jika tidak ubah" class="w-full px-4 py-2 border rounded-md"></td>
      <td class="p-5">
        <select class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
          <option value="admin" ${user.role==='admin'?'selected':''}>admin</option>
          <option value="guru" ${user.role==='guru'?'selected':''}>guru</option>
        </select>
      </td>
      <td class="p-5">
        <button onclick="saveUser(${user.row}, this)" class="bg-primary hover:bg-indigo-700 text-white px-5 py-2 rounded-md flex items-center gap-2 shadow">
          <svg class="w-5 h-5"><use href="#hero-check"/></svg>
          Simpan
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function saveUser(row, button) {
  const tr = button.closest('tr');
  const nama = tr.querySelector('input:nth-child(1)').value.trim();
  const username = tr.querySelector('input:nth-child(2)').value.trim();
  const password = tr.querySelector('input[type=password]').value;
  const role = tr.querySelector('select').value;

  if (!nama || !username) {
    showToast('Nama dan username wajib diisi!', 'error');
    return;
  }

  const result = await apiCall('updateUser', { row, nama, username, password, role }, 'POST');
  if (result.success) {
    showToast('Data berhasil disimpan!', 'success');
  } else {
    showToast('Gagal menyimpan data', 'error');
  }
}

// Init
if (currentUser) {
  initApp();
} else {
  document.getElementById('todayDate').textContent = formatDate(new Date());
}
</script>

</body>
</html>
